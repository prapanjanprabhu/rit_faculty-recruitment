{% extends "faculty_requirement/base.html" %}
{% load faculty_tags %}
{% load static %}

{% load static %}

{% block page_title %}Teaching and Contribution{% endblock %}
{% block header_meta %}
  <div>Provide details of your Teaching Experience</div>
{% endblock %}

{% block extra_css %}

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Calibri','Segoe UI',sans-serif;background:#f8f9fa;padding:20px;color:#333}
.container{max-width:1000px;margin:auto;background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1);overflow:hidden;border:1px solid #ddd}
.header{background:#003366;color:#fff;padding:20px;text-align:center;border-bottom:4px solid #ffcc00}
.header h1{font-size:24px;margin-bottom:5px;font-weight:600}
.header p{font-size:14px;opacity:.9}
.form-section{padding:25px}
.section-title{color:#003366;font-size:18px;font-weight:600;margin:25px 0 15px;padding-bottom:8px;border-bottom:2px solid #e0e0e0}
.sub-section-title{color:#475569;font-size:16px;font-weight:600;margin:20px 0 10px;padding-left:10px;border-left:3px solid #003366}
label{display:block;margin-bottom:5px;color:#003366;font-weight:500;font-size:14px}
.required:after{content:" *";color:#d32f2f}
.form-control,textarea{width:100%;padding:8px 12px;border:1px solid #ccc;border-radius:4px;font-size:14px}
.block{background:#f5f7fa;border:1px solid #ddd;border-radius:5px;padding:15px;margin-bottom:10px;position:relative}
.block:before{content:attr(data-index);position:absolute;top:-10px;left:15px;background:#003366;color:#fff;width:20px;height:20px;border-radius:50%;text-align:center;line-height:20px;font-size:12px}
.ug-block{background:#e8f4f8;border-color:#b3e0f2}
.pg-block{background:#fff8e1;border-color:#ffd54f}
.btn{padding:8px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px}
.btn-add{background:#e9ecef;color:#003366;border:1px dashed #adb5bd;width:100%;margin:10px 0}
.btn-prev{background:#6c757d;color:#fff}
.btn-next{background:#003366;color:#fff}
.remove-btn{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;padding:5px 10px;border-radius:3px;font-size:12px;cursor:pointer;margin-top:10px}
.button-group{display:flex;justify-content:space-between;margin-top:30px;padding-top:20px;border-top:1px solid #eee}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1;min-width:200px}
</style>
{% endblock %}

{% block content %}
    <form method="post">
      {% csrf_token %}

      <!-- ================= UG ================= -->
      <h2 class="section-title">Undergraduate (UG)</h2>
      <div id="ug-container" class="block-container">
        {% if ug_entries %}
          {% for r in ug_entries %}
          <div class="block ug-block" data-index="{{ forloop.counter }}">
            <div class="row">
              <div class="col">
                <label class="required">Subject</label>
                <input type="text" name="ug_subject[]" class="form-control" value="{{ r.subject }}">
              </div>
              <div class="col">
                <label class="required">Pass Percentage</label>
                <input type="number" step="0.01" name="ug_pass_percentage[]" class="form-control" value="{{ r.pass_percentage }}">
              </div>
            </div>

            <label>Department Contribution</label>
            <textarea name="ug_department_contribution[]" class="form-control" rows="2">{{ r.department_contribution }}</textarea>

            <label>College Contribution</label>
            <textarea name="ug_college_contribution[]" class="form-control" rows="2">{{ r.college_contribution }}</textarea>

            {% if not forloop.first %}
              <button type="button" class="remove-btn" onclick="removeBlock(this)">Remove</button>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <div class="block ug-block" data-index="1">
            <div class="row">
              <div class="col">
                <label class="required">Subject</label>
                <input type="text" name="ug_subject[]" class="form-control">
              </div>
              <div class="col">
                <label class="required">Pass Percentage</label>
                <input type="number" step="0.01" name="ug_pass_percentage[]" class="form-control">
              </div>
            </div>

            <label>Department </label>
            <textarea name="ug_department_contribution[]" class="form-control" rows="2"></textarea>

            <label>College </label>
            <textarea name="ug_college_contribution[]" class="form-control" rows="2"></textarea>
          </div>
        {% endif %}
      </div>

      <button type="button" class="btn btn-add" onclick="addBlock('ug')">+ Add UG</button>

      <!-- ================= PG ================= -->
      <h2 class="section-title">Postgraduate (PG)</h2>
      <div id="pg-container" class="block-container">
        {% if pg_entries %}
          {% for r in pg_entries %}
          <div class="block pg-block" data-index="{{ forloop.counter }}">
            <div class="row">
              <div class="col">
                <label class="required">Subject</label>
                <input type="text" name="pg_subject[]" class="form-control" value="{{ r.subject }}">
              </div>
              <div class="col">
                <label class="required">Pass Percentage</label>
                <input type="number" step="0.01" name="pg_pass_percentage[]" class="form-control" value="{{ r.pass_percentage }}">
              </div>
            </div>

            <label>Department </label>
            <textarea name="pg_department_contribution[]" class="form-control" rows="2">{{ r.department_contribution }}</textarea>

            <label>College </label>
            <textarea name="pg_college_contribution[]" class="form-control" rows="2">{{ r.college_contribution }}</textarea>

            {% if not forloop.first %}
              <button type="button" class="remove-btn" onclick="removeBlock(this)">Remove</button>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <div class="block pg-block" data-index="1">
            <div class="row">
              <div class="col">
                <label class="required">Subject</label>
                <input type="text" name="pg_subject[]" class="form-control">
              </div>
              <div class="col">
                <label class="required">Pass Percentage</label>
                <input type="number" step="0.01" name="pg_pass_percentage[]" class="form-control">
              </div>
            </div>

            <label>Department Contribution</label>
            <textarea name="pg_department_contribution[]" class="form-control" rows="2"></textarea>

            <label>College Contribution</label>
            <textarea name="pg_college_contribution[]" class="form-control" rows="2"></textarea>
          </div>
        {% endif %}
      </div>

      <button type="button" class="btn btn-add" onclick="addBlock('pg')">+ Add PG</button>

      <div class="button-group">
        <button type="button" class="btn btn-prev"
          onclick="window.location.href='{% url "academic_and_industry_experience" %}'">
          ← Previous
        </button>
        <button type="submit" class="btn btn-next">
          Save & Next →
        </button>
      </div>

    </form>
{% endblock %}

{% block extra_js %}
<script>
function addBlock(type){
  const cid = type === 'ug' ? 'ug-container' : 'pg-container';
  const container = document.getElementById(cid);

  const clone = container.firstElementChild.cloneNode(true);

  // clear inputs
  clone.querySelectorAll('input,textarea').forEach(el => el.value = "");

  // remove old remove button
  const oldRemove = clone.querySelector(".remove-btn");
  if(oldRemove) oldRemove.remove();

  // add new remove
  const rb = document.createElement("button");
  rb.type = "button";
  rb.className = "remove-btn";
  rb.textContent = "Remove";
  rb.onclick = function(){ removeBlock(this); };
  clone.appendChild(rb);

  container.appendChild(clone);
  updateIndex(container);
}

function removeBlock(btn){
  const container = btn.closest(".block-container");
  btn.parentElement.remove();

  // if only one block, remove its remove-btn
  if(container.children.length === 1){
    const rb = container.firstElementChild.querySelector(".remove-btn");
    if(rb) rb.remove();
  }
  updateIndex(container);
}

function updateIndex(container){
  [...container.children].forEach((b,i)=> b.setAttribute("data-index", i+1));
}

// remove all remove buttons on first load if only 1 item exists per section
document.addEventListener("DOMContentLoaded", function(){
  ["ug-container","pg-container"].forEach(id=>{
    const c = document.getElementById(id);
    if(c && c.children.length === 1){
      const rb = c.firstElementChild.querySelector(".remove-btn");
      if(rb) rb.remove();
    }
    if(c) updateIndex(c);
  });
});
</script>
{% endblock %}